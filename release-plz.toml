# release-plz configuration for McpMux Tauri Desktop App
# https://release-plz.dev/docs/config

[workspace]
# IMPORTANT: Disable release for all packages by default
# Only the mcpmux package will be released (enabled below)
release = false

# Use git tags for version detection (not crates.io) - we're a desktop app
git_only = true

# Don't publish any crates to crates.io
publish = false

# Don't run cargo semver-checks (not a library)
semver_check = false

# Enable GitHub releases (will be enabled for mcpmux package)
git_release_enable = true
git_tag_enable = true

# Tag and release naming
git_tag_name = "v{{ version }}"
git_release_name = "McpMux v{{ version }}"

# Release PR configuration
release_always = true  # Release on every push if version is untagged
pr_name = "chore: release v{{ version }}"
pr_labels = ["release", "automated"]
pr_draft = false

[changelog]
header = """# Changelog

All notable changes to McpMux will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

"""

body = """
{% if version %}
## [{{ version }}]{% if release_link %}({{ release_link }}){% endif %} - {{ timestamp | date(format="%Y-%m-%d") }}
{% endif %}
{% for group, commits in commits | group_by(attribute="group") %}
### {{ group | upper_first }}
{% for commit in commits %}
- {% if commit.scope %}*({{ commit.scope }})* {% endif %}{% if commit.breaking %}**BREAKING:** {% endif %}{{ commit.message }}
{%- if commit.links %} ({% for link in commit.links %}[{{ link.text }}]({{ link.href }}){% endfor %}){% endif %}
{% endfor %}
{% endfor %}
"""

trim = true
protect_breaking_commits = true

# Conventional commit parsing - ORDER MATTERS! Specific patterns must come before generic ones
commit_parsers = [
    { message = "^feat", group = "Features" },
    { message = "^fix", group = "Bug Fixes" },
    { message = "^perf", group = "Performance" },
    { message = "^refactor", group = "Refactoring" },
    { message = "^docs", group = "Documentation" },
    { message = "^style", group = "Styling" },
    { message = "^test", group = "Testing" },
    { message = "^chore\\(deps\\)", group = "Dependencies" },
    { message = "^chore\\(release\\)", skip = true },
    { message = "^ci", group = "CI/CD" },
    { message = "^build", group = "Build" },
    { message = "^chore", group = "Chores" },
    { message = "^.*", group = "Other" },
]

# Convert issue/PR references to links
commit_preprocessors = [
    { pattern = "\\(#([0-9]+)\\)", replace = "([#${1}](https://github.com/MCP-Mux/mcp-mux/pull/${1}))" },
]

# ─────────────────────────────────────────────────────────────────────────────
# PACKAGE CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────
# Only the mcpmux desktop app is released. All other crates inherit
# release = false from [workspace] and are completely ignored by release-plz.

[[package]]
name = "mcpmux"
# Enable release for this package (overrides workspace default of false)
release = true
# Path relative to workspace root
changelog_path = "CHANGELOG.md"
# Include commits from internal crates in the main changelog
changelog_include = ["mcpmux-core", "mcpmux-gateway", "mcpmux-mcp", "mcpmux-storage"]

# Note: Library crates (mcpmux-core, mcpmux-gateway, mcpmux-mcp, mcpmux-storage, tests)
# inherit release = false from [workspace], so they are not processed at all.
# No need to explicitly list them here.
